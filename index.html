<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>头像生成器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        label {
            font-size: 18px;
            cursor: pointer;
            border: 1px solid #ccc;
            padding: 10px 20px;
            border-radius: 5px;
        }
        input[type="file"] {
            display: none;
        }
        canvas {
            margin-top: 20px;
            border: 1px solid #000;
        }
        .controls {
            margin-top: 20px;
        }
        .controls input[type="range"] {
            width: 300px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div style="display: flex;flex-direction: column;align-items: center;">
        <canvas style="margin-bottom: 20px;" id="avatarCanvas" width="200" height="200"></canvas>
        <input type="file" id="upload" accept="image/*" />
        <label for="upload">上传头像</label>

        <div class="controls">
            <label for="scale">缩放:</label>
            <input type="range" id="scale" min="0.1" max="2" step="0.1" value="1">
            <label for="x">X轴位置:</label>
            <input type="range" id="x" min="-100" max="100" step="1" value="0">
            <label for="y">Y轴位置:</label>
            <input type="range" id="y" min="-100" max="100" step="1" value="0">
        </div>

        <button id="downloadBtn">下载头像</button>
    </div>

    <script>
        // JavaScript部分
        const uploadInput = document.getElementById('upload');
        const canvas = document.getElementById('avatarCanvas');
        const ctx = canvas.getContext('2d');
        const scaleInput = document.getElementById('scale');
        const xInput = document.getElementById('x');
        const yInput = document.getElementById('y');

        // 红色圆圈挂件（PSD转为PNG后加载）
        const overlayImage = new Image();
        overlayImage.src = './assets/avaterFrame.PNG'; // 替换为你的红色圆圈挂件图片路径

        // 当图片加载完成后绘制到Canvas上
        overlayImage.onload = function () {
            drawOverlay();
        };

        // 绘制红色圆圈挂件
        function drawOverlay() {
            ctx.drawImage(overlayImage, 0, 0, canvas.width, canvas.height);
        }

        // 定义全局变量来存储用户上传的图片
        let userImage = new Image();

        // 处理用户上传的头像
        uploadInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function (e) {
                userImage.src = e.target.result;

                userImage.onload = function () {
                    // 清空Canvas并绘制用户头像
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    drawUserImage();
                    drawOverlay();
                };
            };

            reader.readAsDataURL(file);
        });

        // 绘制用户头像
        function drawUserImage() {
            const scale = parseFloat(scaleInput.value);
            const x = parseInt(xInput.value);
            const y = parseInt(yInput.value);
            ctx.drawImage(userImage, x, y, userImage.width * scale, userImage.height * scale);
        }

        // 监听缩放和位置变化
        scaleInput.addEventListener('input', function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawUserImage();
            drawOverlay();
        });

        xInput.addEventListener('input', function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawUserImage();
            drawOverlay();
        });

        yInput.addEventListener('input', function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawUserImage();
            drawOverlay();
        });

        const downloadBtn = document.getElementById('downloadBtn');

        downloadBtn.addEventListener('click', function () {
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = 'avatar_with_overlay.png';
            link.click();
        });

    </script>
</body>
</html>